<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ ìµëª…í™”íˆ´</title>
    <style>
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css');
        
        :root {
            --bg-color: #f0f0f0;
            --text-color: #333;
            --container-bg: #fff;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --input-bg: #ffffff;
            --input-border: #bdc3c7;
            --input-text: #333;
            --result-bg: #ecf0f1;
            --checkbox-bg: #fff;
            --checkbox-border: #bdc3c7;
            --label-color: #34495e;
            --h3-bg: #f0f0f0;
            --h3-text: #333;
            --inspection-bg: #f8f9fa;
            --inspection-border: #dee2e6;
            --highlight-a: #FFD700;
            --highlight-c: #90EE90;
            --snippet-bg: #ffffff;
            --snippet-border: #bdc3c7;
        }

        .dark-mode {
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --container-bg: #34495e;
            --button-bg: #2980b9;
            --button-hover: #3498db;
            --input-bg: #3b4b5a;
            --input-border: #506070;
            --input-text: #ecf0f1;
            --result-bg: #3b4b5a;
            --checkbox-bg: #3b4b5a;
            --checkbox-border: #506070;
            --label-color: #ecf0f1;
            --h3-bg: #34495e;
            --h3-text: #ecf0f1;
            --inspection-bg: #34495e;
            --inspection-border: #506070;
            --highlight-c: #32CD32;
            --snippet-bg: #3b4b5a;
            --snippet-border: #506070;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: var(--text-color);
        }

        textarea, input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--input-text);
            box-sizing: border-box;
        }

        textarea {
            height: 150px;
            resize: vertical;
        }

        .input-row {
            display: flex;
            justify-content: space-between;
        }

        .input-row input {
            width: calc(50% - 5px);
        }

        button {
            padding: 10px 15px;
            background-color: var(--button-bg);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-right: 10px;
        }

        button:hover {
            background-color: var(--button-hover);
        }

        #result {
            margin-top: 20px;
            border: 1px solid var(--input-border);
            padding: 15px;
            min-height: 100px;
            background-color: var(--result-bg);
            border-radius: 4px;
        }

        .type-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .type-button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #95a5a6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .type-button.active {
            background-color: var(--button-bg);
        }

        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }

        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }

		.checkbox-container {
			display: flex;
			align-items: center; /* ì²´í¬ë°•ìŠ¤ì™€ ë ˆì´ë¸”ì˜ ì„¸ë¡œ ì •ë ¬ì„ ë§ì¶¤ */
			margin-bottom: 15px;
		}

		.checkbox-container input[type="checkbox"] {
			appearance: auto; /* ê¸°ë³¸ ë¸Œë¼ìš°ì € ìŠ¤íƒ€ì¼ ìœ ì§€ */
			margin-right: 8px;
			width: 16px;
			height: 16px;
			border-radius: 4px;
			background-color: var(--checkbox-bg);
			border: 1px solid var(--checkbox-border);
			cursor: pointer;
		}

		/* ë‹¤í¬ ëª¨ë“œì—ì„œ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ ì ìš© */
		.dark-mode .checkbox-container input[type="checkbox"] {
			appearance: none; /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì œê±° */
			margin-right: 8px;
			width: 16px;
			height: 16px;
			border-radius: 4px;
			background-color: var(--checkbox-bg);
			border: 1px solid var(--checkbox-border);
			cursor: pointer;
			display: inline-block; /* ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ë¡œ ìš”ì†Œ ì •ë ¬ */
			vertical-align: middle; /* ì²´í¬ë°•ìŠ¤ì™€ ë ˆì´ë¸”ì˜ ì„¸ë¡œ ì •ë ¬ì„ ë§ì¶¤ */
		}

		.checkbox-container input[type="checkbox"]:checked {
			background-color: var(--button-bg);
			border-color: var(--button-hover);
		}

		.checkbox-container label {
			margin-right: 20px;
			font-size: 14px;
			color: var(--label-color);
			vertical-align: middle; /* í…ìŠ¤íŠ¸ì™€ ì²´í¬ë°•ìŠ¤ì˜ ì„¸ë¡œ ì •ë ¬ì„ ë§ì¶¤ */
			cursor: pointer;
		}



        .snippet {
            background-color: var(--snippet-bg);
            border: 1px solid var(--snippet-border);
            border-radius: 4px;
            padding: 8px;
            margin: 5px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-width: 100%;
            overflow: hidden;
        }

        .highlight-a {
            background-color: var(--highlight-a);
            color: #000;
            padding: 2px 0;
            border-radius: 3px;
        }

        .highlight-c {
            background-color: var(--highlight-c);
            color: #000;
            padding: 2px 0;
            border-radius: 3px;
        }

		/* preset-section ì™¸ê³½ì„  ì œê±° */
		.preset-section {
			margin: 20px 0;
            padding: 15px;
			border: none; /* ì™¸ê³½ì„  ì œê±° */
		}

		/* í”„ë¦¬ì…‹ íŒŒì¼ ê´€ë¦¬ h4 ìŠ¤íƒ€ì¼ */
		.file-management-header {
			background-color: var(--h3-bg); /* ë°°ê²½ìƒ‰ì„ h3ì™€ ë™ì¼í•˜ê²Œ */
			color: var(--h3-text);
			padding: 10px 15px;
			margin: 0;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.file-management-header:hover {
			background-color: #e0e0e0; /* í˜¸ë²„ ì‹œ ì•½ê°„ì˜ ë°ì€ íš¨ê³¼ ì¶”ê°€ */
		}

		.dark-mode .file-management-header {
			background-color: var(--container-bg);
			color: var(--text-color);
		}

		.dark-mode .file-management-header:hover {
			background-color: #3b4b5a;
		}

		/* Collapsible ì„¹ì…˜ ê³µí†µ ìŠ¤íƒ€ì¼ */
		.collapsible .content {
			padding: 15px;
			display: none;
		}

		.collapsible .content.show {
			display: block;
		}
		
		
        .preset-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-name {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        .preset-buttons button {
            width: 100%;
            margin: 5px 0;
        }

        .preset-section h3 {
            cursor: pointer;
            padding: 10px;
            margin: 0;
            background-color: var(--h3-bg);
            color: var(--h3-text);
            border-bottom: 1px solid var(--input-border);
        }

        .preset-section .content {
            padding: 15px;
            display: none;
        }

        .collapse-icon {
            float: right;
        }

        .file-management-section button {
            padding: 10px 15px;
            margin-right: 10px;
        }

        .file-management-section i {
            margin-right: 5px;
        }

        .copy-button {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
        }

        .copy-button:hover {
            background-color: #45a049;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--button-bg);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .theme-toggle:hover {
            background-color: var(--button-hover);
        }
		
		
		.confirm-toast {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: var(--container-bg);
			color: var(--text-color);
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 0 10px rgba(0,0,0,0.3);
			z-index: 1000;
			text-align: center;
		}

		.confirm-toast button {
			margin: 10px;
			padding: 5px 10px;
		}

		.file-management-buttons {
			display: flex;
			justify-content: space-between;
			margin-top: 15px;
		}

		.file-button {
			flex: 1;
			margin: 0 5px;
			padding: 10px;
			font-size: 14px;
			border-radius: 5px;
			transition: all 0.3s ease;
		}

		.export-button {
			background-color: #3498db;
			color: white;
		}

		.import-button {
			background-color: #2ecc71;
			color: white;
		}

		.file-button:hover {
			transform: translateY(-2px);
			box-shadow: 0 2px 5px rgba(0,0,0,0.2);
		}

		.file-button i {
			margin-right: 5px;
		}

		#result {
			cursor: pointer;
			position: relative;
			transition: background-color 0.2s;
		}

		#result:hover {
			background-color: #f0f8ff; /* í´ë¦­ ì‹œ ê°•ì¡° ìƒ‰ìƒ (ì—°í•œ íŒŒë€ìƒ‰) */
		}

		.dark-mode #result:hover {
			background-color: #2a4a6c; /* ì¡°ì •ëœ ë°°ê²½ìƒ‰ */
		}

    </style>
</head>
<body>
    <div class="container">
        <button id="themeToggle" class="theme-toggle">
            <i class="fas fa-moon"></i>
        </button>

        <h1>ë¡œê·¸ ìµëª…í™” íˆ´</h1>
		<div class="preset-section collapsible">
			<h3 onclick="toggleCollapse(this)">í”„ë¦¬ì…‹ ê´€ë¦¬ (ìŠ¬ë¡¯ 1~10) <span class="collapse-icon">â–¼</span></h3>
			<div class="content">
				<div class="preset-inner">
					<select id="presetSlot" class="preset-name"></select>
					<div class="preset-controls">
						<input type="text" id="presetName" placeholder="í”„ë¦¬ì…‹ ì´ë¦„" class="preset-name">
						<div class="preset-buttons">
							<button onclick="savePreset()">ì €ì¥</button>
							<button onclick="loadPreset()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
						</div>
					</div>
				</div>

				<!-- í”„ë¦¬ì…‹ íŒŒì¼ ê´€ë¦¬ ì„¹ì…˜ -->
				<div class="file-management-section collapsible">
					<h4 onclick="toggleCollapse(this)" class="file-management-header">
						ğŸ“‚ í”„ë¦¬ì…‹ íŒŒì¼ ê´€ë¦¬ <span class="collapse-icon">â–¼</span>
					</h4>
					<div class="content">
						<p>í”„ë¦¬ì…‹ì„ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê±°ë‚˜ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
						<div class="file-management-buttons">
							<button onclick="exportPresets()" class="file-button export-button">
								<i class="fas fa-file-export"></i> ë‚´ë³´ë‚´ê¸°
							</button>
							<button onclick="importPresets()" class="file-button import-button">
								<i class="fas fa-file-import"></i> ê°€ì ¸ì˜¤ê¸°
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>



        <div class="type-selector">
            <button class="type-button active" onclick="selectType('ì¼ê´„ë³€í™˜')" id="fullTransform">ì¼ê´„ë³€í™˜</button>
            <button class="type-button" onclick="selectType('ê·œì¹™ë³€í™˜')" id="ruleTransform">ê·œì¹™ë³€í™˜</button>
        </div>

        <label for="text">ì „ì²´ í…ìŠ¤íŠ¸:</label>
        <textarea id="text" placeholder="ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        
        <div class="input-row">
            <input type="text" id="wordA" placeholder="Char">
            <input type="text" id="wordB" placeholder="ğŸ¤–ê¹¡í†µ">
        </div>
        
        <div class="input-row">
            <input type="text" id="wordC" placeholder="user">
            <input type="text" id="wordD" placeholder="ğŸ§ê¹¡ìº">
        </div>
        
        <div class="checkbox-container">
            <label>
                <input type="checkbox" id="checkA"> Charì´ë¦„ ê²€ì‚¬
            </label>
            <label>
                <input type="checkbox" id="checkC"> Userì´ë¦„ ê²€ì‚¬
            </label>
        </div>
        
        <button onclick="transformText()">ë³€í™˜</button>
        <button onclick="copyToClipboard()" class="copy-button">ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
        
        <div id="result"></div>
        <div id="inspectionResult"></div>
        

    </div>

    <div id="toast"></div>
    <script>
        let presets = JSON.parse(localStorage.getItem('presets')) || Array(10).fill().map(() => ({
            name: 'ë¹ˆ ìŠ¬ë¡¯',
            settings: null
        }));

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í”„ë¦¬ì…‹ ìŠ¬ë¡¯ ëª©ë¡ ìƒì„±
        function initPresetSlots() {
            const presetSelect = document.getElementById('presetSlot');
            presetSelect.innerHTML = presets.map((p, i) => 
                `<option value="${i}">ìŠ¬ë¡¯ ${i+1}: ${p.name}</option>`
            ).join('');
        }
        initPresetSlots();

        // ì„¤ì • ì €ì¥
		function savePreset() {
			const slot = document.getElementById('presetSlot').value;
			const presetName = document.getElementById('presetName').value || `ìŠ¬ë¡¯ ${+slot+1}`;
			
			if (presets[slot].settings) {
				showConfirmToast(`ìŠ¬ë¡¯ ${+slot+1}ì— ì´ë¯¸ ì €ì¥ëœ í”„ë¦¬ì…‹ì´ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?`, () => {
					savePresetAction(slot, presetName);
				});
			} else {
				savePresetAction(slot, presetName);
			}
		}

		function savePresetAction(slot, presetName) {
			presets[slot] = {
				name: presetName,
				settings: {
					currentType: currentType,
					wordA: document.getElementById('wordA').value,
					wordB: document.getElementById('wordB').value,
					wordC: document.getElementById('wordC').value,
					wordD: document.getElementById('wordD').value,
					checkA: document.getElementById('checkA').checked,
					checkC: document.getElementById('checkC').checked
				}
			};
			
			localStorage.setItem('presets', JSON.stringify(presets));
			initPresetSlots();
			showToast(`${presetName} ì„¤ì • ì €ì¥ ì™„ë£Œ!`);
		}
		
		function showConfirmToast(message, onConfirm) {
			const toast = document.createElement('div');
			toast.className = 'confirm-toast';
			toast.innerHTML = `
				<p>${message}</p>
				<button class="confirm-yes">ì˜ˆ</button>
				<button class="confirm-no">ì•„ë‹ˆì˜¤</button>
			`;
			document.body.appendChild(toast);

			toast.querySelector('.confirm-yes').addEventListener('click', () => {
				onConfirm();
				document.body.removeChild(toast);
			});

			toast.querySelector('.confirm-no').addEventListener('click', () => {
				document.body.removeChild(toast);
			});
		}


        // ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° 
        function loadPreset() {
            const slot = document.getElementById('presetSlot').value;
            const preset = presets[slot];
            
            if(!preset.settings) {
                showToast('ì´ ìŠ¬ë¡¯ì€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
                return;
            }

            const {currentType, wordA, wordB, wordC, wordD, checkA, checkC} = preset.settings;
            
            selectType(currentType);
            document.getElementById('wordA').value = wordA;
            document.getElementById('wordB').value = wordB;
            document.getElementById('wordC').value = wordC;
            document.getElementById('wordD').value = wordD;
            document.getElementById('checkA').checked = checkA;
            document.getElementById('checkC').checked = checkC;
            
            showToast(`${preset.name} ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!`);
        }
		
		function exportPresets() {
			const presetData = JSON.stringify(presets);
			const blob = new Blob([presetData], {type: 'application/json'});
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'text_converter_presets.json';
			a.click();
			URL.revokeObjectURL(url);
		}

        function importPresets() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.json';
            
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) {
                    showToast('íŒŒì¼ ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedPresets = JSON.parse(e.target.result);
                        if (!Array.isArray(importedPresets) || importedPresets.length !== 10) {
                            throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ í”„ë¦¬ì…‹ ë°ì´í„° êµ¬ì¡°ì…ë‹ˆë‹¤.');
                        }
                        presets = importedPresets;
                        localStorage.setItem('presets', JSON.stringify(presets));
                        initPresetSlots();
                        showToast('í”„ë¦¬ì…‹ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                    } catch (error) {
                        showToast(`í”„ë¦¬ì…‹ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ${error.message}`);
                    }
                };
                reader.readAsText(file);
            };
            
            fileInput.click();
        }

    </script>
	
	
    <script>
        let currentType = 'ì¼ê´„ë³€í™˜';

        function selectType(type) {
            currentType = type;
            document.getElementById('fullTransform').classList.toggle('active', type === 'ì¼ê´„ë³€í™˜');
            document.getElementById('ruleTransform').classList.toggle('active', type === 'ê·œì¹™ë³€í™˜');
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function hasFinalConsonant(word) {
            if (!/[\uAC00-\uD7A3]/.test(word)) return false;
            const lastChar = word[word.length - 1];
            return (lastChar.charCodeAt(0) - 0xAC00) % 28 > 0;
        }

        function ruleBasedTransform(text, fromWord, toWord) {
            const josaPairs = [
                ['ì—ê²Œì„œ', 'ì—ê²Œì„œ'], ['ì—ê²Œ', 'ì—ê²Œ'], 
                ['ìœ¼ë¡œ', 'ë¡œ'], ['ì´ë¼', 'ë¼'], ['ì´ë‘', 'ë‘'], ['ì´ê³ ', 'ê³ '],
                ['ì´ë©°', 'ë©°'], ['ì´ì—ˆ', 'ì˜€'], ['ì´ì—¬', 'ì—¬'], ['ì´ì•¼', 'ì•¼'],
                ['ì„', 'ë¥¼'], ['ì´', 'ê°€'], ['ì€', 'ëŠ”'], ['ê³¼', 'ì™€'],
                ['ì˜', 'ì˜']
            ];

            let caseType = 1;
            let replaceWord = '';
            const isToKorean = /[\uAC00-\uD7A3]/.test(toWord);
            const isFromKorean = /[\uAC00-\uD7A3]/.test(fromWord);

            if(isToKorean && isFromKorean) {
                const fromFinal = hasFinalConsonant(fromWord);
                const toFinal = hasFinalConsonant(toWord);
                caseType = (fromFinal === toFinal) ? 21 : 22;
            }


			console.log(`[ì¼€ì´ìŠ¤ ${caseType}] ${
				caseType === 1 ? 'toWord ë¹„í•œê¸€' : 
				caseType === 21 ? 'ì¢…ì„± ë™ì¼' : 'ì¢…ì„± ë‹¤ë¦„'
			}`);
			
			
			for (let [josa1, josa2] of josaPairs) {
				let searchWord1 = fromWord + josa1;
				let searchWord2 = fromWord + josa2;

				// ì²« ë²ˆì§¸ ì¡°ì‚¬ ì¡°í•© ê²€ì‚¬ ë° ì¹˜í™˜
				if (text.includes(searchWord1)) {
					console.log(`[${searchWord1}] [ê²€ìƒ‰ê²°ê³¼: O]`);
					
					if(caseType == 22){
						replaceWord = toWord + josa2;
						console.log(`[${replaceWord}] [ë³€í™˜ëŒ€ìƒì¡°ì‚¬]`);
					}else{
						replaceWord = toWord + josa1;		
						console.log(`[${replaceWord}] [ë³€í™˜ëŒ€ìƒì¡°ì‚¬]`);	
					}
					
					//let replaceWord = toWord + (hasFinalConsonant(toWord) ? josa1 : josa2);
					text = text.replace(new RegExp(escapeRegExp(searchWord1), 'g'), replaceWord);
					console.log(`ì¹˜í™˜: ${searchWord1} â†’ ${replaceWord}`);
				} else {
					console.log(`[${searchWord1}] [ê²€ìƒ‰ê²°ê³¼: X]`);
				}

				// ë‘ ë²ˆì§¸ ì¡°ì‚¬ ì¡°í•© ê²€ì‚¬ ë° ì¹˜í™˜
				if (text.includes(searchWord2)) {
					console.log(`[${searchWord2}] [ê²€ìƒ‰ê²°ê³¼: O]`);
					
					if(caseType == 22){
						replaceWord = toWord + josa1;
						console.log(`[${replaceWord}] [ë³€í™˜ëŒ€ìƒì¡°ì‚¬]`);
					}else{
						replaceWord = toWord + josa2;		
						console.log(`[${replaceWord}] [ë³€í™˜ëŒ€ìƒì¡°ì‚¬]`);	
					}
					
					//let replaceWord = toWord + (hasFinalConsonant(toWord) ? josa1 : josa2);
					
					text = text.replace(new RegExp(escapeRegExp(searchWord2), 'g'), replaceWord);
					console.log(`ì¹˜í™˜: ${searchWord2} â†’ ${replaceWord}`);
				} else {
					console.log(`[${searchWord2}] [ê²€ìƒ‰ê²°ê³¼: X]`);
				}
			}
			
			
			// trim-ê·œì¹™ì— ë”°ë¥¸ fromWordë¥¼ toWordë¡œ êµì²´
			const trimPattern = /([^a-zA-Z0-9ê°€-í£])/;
			const words = text.split(trimPattern);
			
			for (let i = 0; i < words.length; i++) {
				if (words[i] === fromWord) {
					words[i] = toWord;
					console.log(`[ë‹¨ì–´ êµì²´] ${fromWord} â†’ ${toWord}`);
				}
			}

			text = words.join('');

			return text;
		}

		function transformText() {
			let text = document.getElementById('text').value;
			const wordA = document.getElementById('wordA').value;
			const wordB = document.getElementById('wordB').value;
			const wordC = document.getElementById('wordC').value;
			const wordD = document.getElementById('wordD').value;

			if (currentType === 'ê·œì¹™ë³€í™˜') {
				text = ruleBasedTransform(text, wordA, wordB);
				text = ruleBasedTransform(text, wordC, wordD);
			} else {
				// ê¸°ì¡´ ì¼ê´„ë³€í™˜ ë¡œì§
				text = text.replace(new RegExp(escapeRegExp(wordA), 'g'), wordB);
				text = text.replace(new RegExp(escapeRegExp(wordC), 'g'), wordD);
			}
			
			document.getElementById('result').innerText = text;
			showToast(`${currentType}ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);
			inspectText(text);
		}

		function inspectText(text) {
			const checkA = document.getElementById('checkA').checked;
			const checkC = document.getElementById('checkC').checked;
			const wordA = document.getElementById('wordA').value;
			const wordC = document.getElementById('wordC').value;
			let inspectionResult = "";

			function processMatches(word, matches, label) {
				if (matches.length === 0) return;

				const highlightClass = label === 'A' ? 'highlight-a' : 'highlight-c';
				inspectionResult += `<h3> "<span class="${highlightClass}">${word}</span>" ${matches.length}íšŒ ê²€ìƒ‰ë¨:</h3>`;
				
				const contextWindow = 10; // ë‹¨ì–´ ê¸°ì¤€ ì»¨í…ìŠ¤íŠ¸
				
				matches.forEach((match) => {
					const [fullText, before, target, after] = getTextChunk(match.index, word.length, contextWindow);
					const highlighted = `${escapeHtml(before)}<span class="${highlightClass}">${escapeHtml(target)}</span>${escapeHtml(after)}`;
					inspectionResult += `<div class="snippet">...${highlighted}...</div>`;
				});
			}
        
        function getTextChunk(startIndex, wordLength, windowSize) {
            const words = text.split(/(\s+)/);
            let wordIndex = -1;
            let charCount = 0;
        
            // ë‹¨ì–´ ì¸ë±ìŠ¤ ì°¾ê¸°
            for (let i = 0; i < words.length; i++) {
                if (charCount + words[i].length > startIndex) {
                    wordIndex = i;
                    break;
                }
                charCount += words[i].length;
            }
        
            if (wordIndex === -1) return ['', '', '', ''];
        
            const start = Math.max(0, wordIndex - windowSize);
            const end = Math.min(words.length, wordIndex + windowSize + 1);
        
            const before = words.slice(start, wordIndex).join('');
            const target = words[wordIndex];
            const after = words.slice(wordIndex + 1, end).join('');
        
            return [text, before, target, after];
        }



		// XSS ë°©ì§€ í•¨ìˆ˜
		function escapeHtml(unsafe) {
			return unsafe.toString()
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}
			// ì²´í¬ë°•ìŠ¤ê°€ í•˜ë‚˜ë¼ë„ ì„ íƒë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
			if (checkA || checkC) {
				if (checkA && wordA) {
					const regexA = new RegExp(escapeRegExp(wordA), 'g');
					const matchesA = [...text.matchAll(regexA)];
					processMatches(wordA, matchesA, 'A');
				}

				if (checkC && wordC) {
					const regexC = new RegExp(escapeRegExp(wordC), 'g');
					const matchesC = [...text.matchAll(regexC)];
					processMatches(wordC, matchesC, 'C');
				}

				document.getElementById('inspectionResult').innerHTML = inspectionResult || 
					"<div class='snippet'>âœ… ëª¨ë“  ë‹¨ì–´ ê²€ì‚¬ ì™„ë£Œ</div>";
			} else {
				// ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•Œ
				document.getElementById('inspectionResult').innerHTML = 
					"<div class='snippet'>ë‹¨ì–´ ê²€ì‚¬ê°€ ë¹„í™œì„± ìƒíƒœì…ë‹ˆë‹¤</div>";
			}
		}
		
		function copyToClipboard() {
			const result = document.getElementById('result');
			const text = result.innerText || result.textContent;
			
			if (navigator.clipboard && window.isSecureContext) {
				// ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›í•˜ëŠ” Clipboard API ì‚¬ìš©
				navigator.clipboard.writeText(text).then(() => {
					showToast('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
				}).catch(err => {
					console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
					showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				});
			} else {
				// êµ¬í˜• ë¸Œë¼ìš°ì €ë¥¼ ìœ„í•œ ëŒ€ì²´ ë°©ë²•
				const textArea = document.createElement('textarea');
				textArea.value = text;
				textArea.style.position = 'fixed';  // í™”ë©´ ë°–ìœ¼ë¡œ ìœ„ì¹˜ì‹œí‚´
				document.body.appendChild(textArea);
				textArea.focus();
				textArea.select();
				try {
					document.execCommand('copy');
					showToast('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
				} catch (err) {
					console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
					showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				}
				document.body.removeChild(textArea);
			}
		}

		function showToast(message) {
			var toast = document.getElementById("toast");
			toast.innerText = message;
			toast.className = "show";
			setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
		}

		function toggleCollapse(element) {
			const content = element.nextElementSibling;
			const isCollapsed = content.style.display !== "block";

			content.style.display = isCollapsed ? "block" : "none";
			element.setAttribute("data-collapsed", isCollapsed);
		}

		const themeToggle = document.getElementById('themeToggle');
		const body = document.body;
		const icon = themeToggle.querySelector('i');

		themeToggle.addEventListener('click', () => {
			body.classList.toggle('dark-mode');
			if (body.classList.contains('dark-mode')) {
				icon.classList.remove('fa-moon');
				icon.classList.add('fa-sun');
			} else {
				icon.classList.remove('fa-sun');
				icon.classList.add('fa-moon');
			}
		});

        function toggleCollapse(element) {
            const content = element.nextElementSibling;
            const isCollapsed = content.style.display !== "block";
        
            content.style.display = isCollapsed ? "block" : "none";
            element.setAttribute("data-collapsed", isCollapsed);
        }

		document.getElementById('result').addEventListener('click', copyResultToClipboard);
		document.getElementById('result').addEventListener('touchend', copyResultToClipboard);

		function copyResultToClipboard() {
			const result = document.getElementById('result');
			const text = result.innerText || result.textContent;
			
			if (navigator.clipboard && window.isSecureContext) {
				navigator.clipboard.writeText(text).then(() => {
					showToast('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
				}).catch(err => {
					console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
					showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				});
			} else {
				const textArea = document.createElement('textarea');
				textArea.value = text;
				textArea.style.position = 'fixed';
				textArea.style.opacity = '0';
				document.body.appendChild(textArea);
				textArea.focus();
				textArea.select();
				try {
					document.execCommand('copy');
					showToast('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
				} catch (err) {
					console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
					showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
				}
				document.body.removeChild(textArea);
			}
		}

    </script>
</body>
</html>
